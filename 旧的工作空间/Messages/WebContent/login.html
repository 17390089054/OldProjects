<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="css/iconfont.css" />
		<link rel="stylesheet" href="css/animate.css" />
		<style type="text/css">
			*{margin: 0;padding: 0;}
			body{width: 100%;height: 100vh;font-family: "微软雅黑";overflow: hidden;}
			#center{width: 280px;height: ;margin: 200px auto 0;}
			#f_phone{position: relative;}
			#getMessage{position: absolute;top: 5px;right: 10px;width: 100px;height: 30px;background: rgba(255,255,255,.5);text-align: center;line-height: 30px;cursor: pointer;font-size: 12px;color: #333;user-select: none;}
			#getMessage:hover{background: rgba(255,255,255,.8);}
			#getMessage:active{background: rgba(0,0,0,.5);color: #fff;}
			#phone,#message,#password{width: 280px;height: 40px;text-indent: 16px;color: #fff;background: rgba(3,3,3,.3);outline: none;border: 1px solid rgba(33,33,33,.2);}
			#phone{border-bottom: none;}
			#password{border-top: 1px solid rgba(0,0,0,.4);}
			#btn{margin-top: 30px;width: 280px;height: 40px;text-align: center;line-height: 40px;color: #FFFFFF;background: rgba(3,3,3,.5);transition: .3s;cursor: pointer;}
			#btn:hover{background: #333;}
			#center p{margin-top: 10px;}
			#center a{text-decoration: none;color: #fff;font-size: 14px;}
			#center a i{font-size: 14px;margin-right: 4px;}
			#center .register{float: left;margin-left: 10px;}
			#center .forget{float: right;margin-right: 10px;}
		</style>
	</head>
	<body>
		
		<div id="center">
			<form action="" method="post">
				<div id="f_phone" class="animated bounceInLeft" >
					<input type="text" name="phone" id="phone" autocomplete="off" placeholder="请输入手机号" />
					<div id="getMessage">获取验证码</div>
				</div>
				<input type="text" name="message" id="message" autocomplete="off" class="animated bounceInRight" placeholder="请输入手机六位短信验证码" />
				<input type="password" name="password" id="password" autocomplete="off" class="animated bounceInRight" placeholder="请输入密码" />
				<div id="btn" class="animated zoomIn" onclick="login()">登录</div>
			</form>
			<p class="animated bounceInDown">
				<a href="register.html" class="register"><i class="iconfont icon-icoreg"></i>注册</a>
				<a href="forget.html"class="forget"><i class="iconfont icon-loginandregisterimgforget"></i>忘记密码</a>
			</p>
		</div>
		<script type="text/javascript" src="js/jquery-3.1.1.min.js" ></script>
		<script type="text/javascript" src="js/bg.js"></script>
		<script type="text/javascript">
			$(document).keydown(function(event){
				if(event.keyCode==13){
					login();
				}
			});
			
			var mCode = "";
			function getMessage(){
				var phone = $("#phone").val();
				if(phone==""||phone==null){
					alert("请输入您的手机号码！");
					$("#phone").focus();
					
				}else if(!isPhone(phone)){
						alert("您输入的手机号码格式不正确！");
						$("#phone").select();
				}else{
					$.ajax({
						type:"post",
						url:"sendCode",
						data:{"phone":phone},
						success:function(data){
							if(data=="error"){
								alert("验证码获取失败！");
							}else{
								mCode = data;
							}
						}
					});
				}
			}
			
			// 判断手机号格式是否正确
			function isPhone(phone){
				var pattern = /^1[34578]\d{9}$/;
				return pattern.test(phone);
			}
			
			function login(){
				var phone = $("#phone").val();
				var password = $("#password").val();
				var message = $("#message").val();
				if(phone==""||phone==null){
					alert("请输入手机号！");
					$("#phone").focus();
				}else if(!isPhone(phone)){
					alert("您输入的手机号码格式不正确！");
					$("#phone").select();
				}else if(message==""||message==null){
					alert("请输入手机验证码！");
					$("#message").focus();
				}else if(message!=mCode){
					alert("手机验证码错误！");
					$("#message").select();
				}else if(password==""||password==null){
					alert("请输入密码！");
					$("#password").focus();
				}else{
					$.ajax({
						type:"post",
						url:"Login",
						data:{"phone":phone,"password":password},
						success:function(data){
							if(data=="success"){
								window.location.href="index.jsp";
							}else{
								alert("手机号或密码错误！");
								$("#password").select();
							}
						}
					});
				}
			}
			
			
			
			$('#getMessage').click(function () {
                var count = 30;
                var countdown = setInterval(CountDown, 1000);
                getMessage();
                function CountDown() {
                    $("#getMessage").attr("disabled", true);
                    $("#getMessage").text("重新发送(" + count + ")秒!");
                    if (count == 0) {
                        $("#getMessage").text("获取验证码").removeAttr("disabled");
                        clearInterval(countdown);
                    }
                    count--;
                }
            })
		</script>
	</body>
</html>
